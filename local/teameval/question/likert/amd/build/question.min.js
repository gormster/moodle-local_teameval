define(["jquery","local_teameval/question","core/templates","core/ajax","core/str"],function(a,b,c,d,e){function f(a,c,d,e,f,g,h){b.apply(this,arguments),this._self=e,this._editable=f,h=h||{},this._submissioncontext=h.submissioncontext||{},this._editingcontext=h.editingcontext||{},this._editinglocked=h.editinglocked||!1,this._editingcontext._id=this.teameval,this._meanings={},this.pluginName="likert"}return f.prototype=new b,f.prototype.submissionContext=function(){return this._submissioncontext},f.prototype.editingView=function(){return this.editForm("\\teamevalquestion_likert\\forms\\settings_form",a.param(this._editingcontext),{locked:this._editinglocked}).done(function(){this.container.find('[name="range[min]"], [name="range[max]"]').change(this.updateMeanings.bind(this))}.bind(this))},f.prototype.save=function(a){this.updateMeanings();var b=this.container.find("form");return this.saveForm(b,a,{},function(a){this._submissioncontext=JSON.parse(a.submissionContext)}.bind(this))},f.prototype.submit=function(){var b=[];this.container.find('.responses tbody input[type="radio"]:checked').each(function(){var c=a(this).data("touser"),d={};d.touser=c,d.value=this.value,b.push(d)});var c=d.call([{methodname:"teamevalquestion_likert_submit_response",args:{teamevalid:this.teameval,id:this.questionID,marks:b}}]),e=this.checkComplete();return c[0].then(function(){return{incomplete:e}})},f.prototype.updateMeanings=function(){for(var a=parseInt(this.container.find('[name="range[min]"]').val()),b=parseInt(this.container.find('[name="range[max]"]').val()),c=0;10>=c;c++){var d=this.container.find('[name="meanings['+c+']"]');this._meanings[c]=d.val(),this._editinglocked||(this._meanings[c]&&d.val(this._meanings[c]),c>=a&&b>=c?d.closest(".fitem").addBack().removeClass("hidden"):d.closest(".fitem").addBack().addClass("hidden"))}},f.prototype.validateData=function(b){var c=a.Deferred(),d=function(c){return a(b).find('[name="'+c+'"]').val()};return 0===d("title").trim().length&&0===d("description").trim().length?e.get_string("titleordescription","teamevalquestion_likert").done(function(a){this.container.find("[name=title]").closest(".control-group").addClass("error").end().next(".help-inline").text(a),c.reject()}):c.resolve(),c.promise()},f.prototype.checkComplete=function(){var b=this._submissioncontext.users.map(function(a){return parseInt(a.userid)}),c=this.container.find("input:radio:checked").map(function(){return a(this).data("touser")}).get(),d=b.filter(function(a){return-1===c.indexOf(a)});return d.length>0?this.container.parent().addClass("incomplete"):this.container.parent().removeClass("incomplete"),d.length>0},f});