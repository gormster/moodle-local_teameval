define(["jquery","local_teameval/question","core/templates","core/ajax","core/str","local_teameval/editor","local_teameval/formparse"],function(a,b,c,d,e,f,g){function h(a,c,d,e,f,g,h,i){b.apply(this,arguments),this._self=e,this._editable=f,i=i||{},this._submissioncontext=i.submissioncontext||{},this._editingcontext=i.editingcontext||{},this._editinglocked=i.editinglocked||!1,this._editingcontext.teameval=this.teameval,this._meanings={},this.pluginName="likert"}return h.prototype=new b,h.prototype.submissionContext=function(){return this._submissioncontext},h.prototype.editingView=function(){return this.editForm("\\teamevalquestion_likert\\forms\\settings_form",a.param(this._editingcontext),{locked:this._editinglocked}).done(function(){this.container.find('[name="range[min]"], [name="range[max]"]').change(this.updateMeanings.bind(this))}.bind(this))},h.prototype.save=function(a){this.updateMeanings();var b=this.container.find("form");f.saveAll(b);var c=g.serializeObject(b);return this.saveForm(b,a,{},function(a){this._submissioncontext=JSON.parse(a.submissionContext),this._editingcontext=c,this._editingcontext.id=a.id}.bind(this))},h.prototype.submit=function(b){var c=[];this.container.find('.responses tbody input[type="radio"]:checked').each(function(){var b=a(this).data("touser"),d={};d.touser=b,d.value=this.value,c.push(d)}),b({methodname:"teamevalquestion_likert_submit_response",args:{teamevalid:this.teameval,id:this.questionID,marks:c}});var d=this.checkComplete();return!d},h.prototype.updateMeanings=function(){for(var a=parseInt(this.container.find('[name="range[min]"]').val()),b=parseInt(this.container.find('[name="range[max]"]').val()),c=0;c<=10;c++){var d=this.container.find('[name="meanings['+c+']"]');this._meanings[c]=d.val(),this._editinglocked||(c>=a&&c<=b?d.closest(".fitem").addBack().removeClass("hidden"):d.closest(".fitem").addBack().addClass("hidden"))}},h.prototype.validateData=function(b){var c=a.Deferred(),d=g.serializeObject(b);return 0===d.title.trim().length&&0===d.description.text.trim().length?e.get_string("titleordescription","teamevalquestion_likert").done(function(a){this.container.find("[name=title]").closest(".control-group").addClass("error").end().next(".help-inline").text(a),c.reject()}.bind(this)):c.resolve(),c.promise()},h.prototype.checkComplete=function(){var b=this._submissioncontext.users.map(function(a){return parseInt(a.userid)}),c=this.container.find("input:radio:checked").map(function(){return a(this).data("touser")}).get(),d=b.filter(function(a){return c.indexOf(a)===-1});return d.length>0?this.container.parent().addClass("incomplete"):this.container.parent().removeClass("incomplete"),d.length>0},h});