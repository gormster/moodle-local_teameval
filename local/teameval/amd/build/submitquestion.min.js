define(["jquery","core/templates","core/ajax","core/notification","core/str"],function(a,b,c,d,e){var f;return{submit:function(){var b=0;a(".local-teameval-submit-buttons .submit").prop("disabled",!0);var g=a("#local-teameval-questions").find(".question-container").map(function(){return a(this).data("question")});g.sort(function(a,b){return parseInt(b.optional)-parseInt(a.optional)});var h=g.map(function(){var c=a.Deferred(),d=this.submit(function(b){var d=a.Deferred();return b&&b.methodname?c.resolve({question:this,ajaxCall:b,deferred:d}):(c.resolve(),d.resolve()),d.promise()});return d||b++,c});a.when.apply(a,h).done(function(){var g=[].slice.call(arguments).filter(function(a){return void 0!==a}),h=a.Deferred();g.push({ajaxCall:{methodname:"local_teameval_questionnaire_submitted",args:{cmid:f}},deferred:h});for(var i=c.call(g.map(function(a){return a.ajaxCall})),j=0;j<g.length;j++){var k=i[j],l=g[j].deferred;k.done(l.resolve),k.fail(l.reject),k.progress(l.notify)}var m=a.when.apply(a,i);m.always(function(){a(".local-teameval-submit-buttons .submit").prop("disabled",!1)}).done(function(){if(b>0){var c=1==b?"incompletewarning1":"incompletewarning";e.get_string(c,"local_teameval",b).done(function(b){a(".local-teameval-submit-buttons .results.incomplete").text(b).show("fast")})}else a(".local-teameval-submit-buttons .results.incomplete").hide("fast"),a(".local-teameval-submit-buttons .results.saved").show("fast").delay(5e3).hide("fast")}).fail(d.exception)})},initialise:function(c){f=c,b.render("local_teameval/submit_buttons",{}).done(function(c,d){var e=a(".local-teameval-containerbox");e.append(c),b.runTemplateJS(d),a(".local-teameval-submit-buttons .submit").click(this.submit)}.bind(this))}}});